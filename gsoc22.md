# GSoC 2022 - Final Work Report

In this gist, I present my work during the Google Summer of Code (GSoC) 2022 program. In the project, I contributed code to a published book [Probabilistic Machine Learning: An Introduction](https://probml.github.io/pml-book/book1.html) (*book1*) and an upcoming book [Probabilistic Machine Learning: Advanced Topics](https://probml.github.io/pml-book/book2.html) (*book2*) by [Kevin P. Murphy](https://www.cs.ubc.ca/~murphyk/).

I mainly worked on two repositories: i) [pyprobml](https://github.com/probml/pyprobml) (public): a repositiry containing most of the source code for the book; and ii) [bookv2](https://github.com/probml/bookv2) (private): a repository containing source code of the book.

## Highlights
* I worked on this project for 16 weeks and on an average 42 hours a week.
* I refactored the [pyprobml](https://github.com/probml/pyprobml) repository to shift from `.py` files to `.ipynb` files containing code to reproduce figures.
* I added automatic code testing via GitHub workflows to [pyprobml](https://github.com/probml/pyprobml).
* I generated code for several figures in "Gaussian processes" chapter.
* I developed a Bayesian optimization library in JAX called [BIJAX](https://github.com/patel-zeel/bijax).
* I co-authored a section (34.7 - Active learning) with Dr. Kevin P. Murphy.
* I learned advanced tools of JAX library.

## `.py` to `.ipynb` conversion
### Background
In [earlier version of repo](https://github.com/probml/pyprobml/tree/3ac9f09de7868ba1d534d4146779d55e72b41641), code for each figure was stored in `.py` files and there were [Jupyter notebooks](https://github.com/probml/pml-book/tree/bd04fe5e27361e04bbffb1b6b66a5213da73010e/pml1/figure_notebooks), each per chapter, containing cells to execute each of those `.py` files. Link to those cells were stored in a private firestore database and a short link was given with each figure in *book1*. 

There were several challanges with this setup:
* It was difficult to maintain and keep this setup up to date due to manual intervention needed at multiple places.
* Due to full `.py` file execution, interactivity with code was minimal.

### Solution
After brainstorming, we decided to move from `.py` file per figure to a self-contained `.ipynb` file per figure which alleviated the need of notebook per chapter. This also enabled readers to play with the notebook more interactively or view the cached figures in the notebook. In the final version, we have notebooks stored in folders renamed as chapter numbers and integrated with book without the need of firestore database.

## Automatic code testing
### Background
Code for any repository needs be up to date with packages it depends on. [pyprobml](https://github.com/probml/pyprobml) depends on lots of packages and thus automatic GitHub workflow testing can be beneficial to test the code on every push.

### Solution
I implemented majority part of [workflow](https://github.com/probml/pyprobml/blob/master/.github/workflows/notebooks.yml) which: i) runs and chekcks all notebooks on every push; ii) statically checks if imported modules are installed/going to be installed locally or not; iii) checks code quality with `black` and iv) pushes some useful statistic to other branches e.g. `auto_generated_figure`. Following PRs are major in making these changes:

| URL                                                     | Title                                                           |
|:--------------------------------------------------------|:----------------------------------------------------------------|
| [PR 703](https://github.com/probml/pyprobml/pull/703)   | Add workflow and jupyter-book setup                             |
| [PR 764](https://github.com/probml/pyprobml/pull/764)   | Split the workflow. Enable static module checker.               |
| [PR 795](https://github.com/probml/pyprobml/pull/795)   | Combine and publish results from parallel workflows             |

## Figures for Gaussian processes chapter

Gaussian processes are related to my thesis topic and thus I wrote code and/or latexified several figures in the Gaussian processes chapter. Here is the list of figures generated by my code:

* Figure 18.2 [[PR 727](https://github.com/probml/pyprobml/pull/727)] explains ARD in Gaussian processes: a) same lengthscale for both dimensions; ii) lengthscale in one dimension dominates the other.

<p align="center">
  <img align="center" width="583" alt="image" src="https://user-images.githubusercontent.com/59758528/189527802-c3b15377-683b-41b1-9ce8-2906b5a4c70c.png">
</p>

* Figure 18.5 and 18.6 [[PR 721](https://github.com/probml/pyprobml/pull/721), [PR 722](https://github.com/probml/pyprobml/pull/722)] illustrates combination of GP kernels via multiplication and summation

<p align="center">
  <img align="center" width="600" alt="image" src="https://user-images.githubusercontent.com/59758528/189528030-78dbfd7c-5a14-480b-b843-dbf41ad12dfd.png">
</p>
<p align="center">
  <img align="center" width="599" alt="image" src="https://user-images.githubusercontent.com/59758528/189528086-98247beb-0f6b-4d55-8aaa-9c0d2d26a545.png">
</p>

* Figure 18.7 [[PR 728](https://github.com/probml/pyprobml/pull/728), [PR 750](https://github.com/probml/pyprobml/pull/750)] illustrates noisy and noiseless Gaussian process regression: a) samples from prior; b) noiseless regression; c) noisy regression.

<p align="center">
<img width="587" alt="image" src="https://user-images.githubusercontent.com/59758528/189528306-89e73cf0-8838-4852-ad5e-598415e6e7db.png">
</p>

* Figure 18.18 [[PR 919](https://github.com/probml/pyprobml/pull/919)] illustrates GP regression with (a) Maximum likelihood and (b) Fully Bayesian inference. I added `blackjax` version of code for this.

<p align="center">
<img width="560" alt="image" src="https://user-images.githubusercontent.com/59758528/189536209-3d5e7ff5-12c9-4732-87ad-993fce20c19e.png">
</p>

* Figure 18.23 [[PR 874](https://github.com/probml/pyprobml/pull/874)] illustrates spectral mixture kernel fit with GPs. I latexified this figure.

<p align="center">
<img width="554" alt="image" src="https://user-images.githubusercontent.com/59758528/189536401-5ef96d63-989f-4ac5-af1c-ef0da3231a43.png">
</p>

* Figure 18.26 [[PR 871](https://github.com/probml/pyprobml/pull/871)] illustrates Deep kernel learning with Gaussian processes: a) fit with Matern kernel; b) fit with MLP + Matern kernel. I latexifed this figure.

<p align="center">
<img width="549" alt="image" src="https://user-images.githubusercontent.com/59758528/189536692-17056176-ca6d-4fef-a50c-3052314eabeb.png">
</p>

## [BIJAX](https://github.com/patel-zeel/bijax): Bayesian Inference in JAX
We initially thought of writing a generic piece of code to generate multiple Bayesian inference related figures in *book2*. However, realizing the power of Bijactors (transformation functions) in recent methods like [ADVI](https://arxiv.org/abs/1603.00788) and a posibility of applications for a wider community, we are developing BIJAX as a full library. BIJAX supports MAP, [ADVI](https://arxiv.org/abs/1603.00788) and Laplace approximation. We are developing SteinVI and other methods in BIJAX at present.

Following are the figures developed with BIJAX:

* Gaussian Mixture Model with [ADVI](https://arxiv.org/abs/1603.00788) [[PR 1084](https://github.com/probml/pyprobml/pull/1084)]: a) MAP; b-d) posterior samples.

<p align="center">
<img width="458" alt="image" src="https://user-images.githubusercontent.com/59758528/189542058-cbb248d1-4f26-49f8-a08e-73cd7f2dcef4.png">
</p>

* Estimating mean of 2d Gaussian distribution with ADVI [[PR 1081](https://github.com/probml/pyprobml/pull/1081)]

<p align="center">
<img width="263" alt="image" src="https://user-images.githubusercontent.com/59758528/189542207-482c660f-c1a5-4d73-9c45-560f33fc2c4e.png">
</p>

## Co-authored section 34.7 - Active learning

We work on active learning in our lab and earlier I have published an [interactive active learning article](https://patel-zeel.github.io/active-learning-visualization/) at VizxAI. Thus, I helped Dr. Murphy write the section on active learning in *book2*. I mentored two of non-GSoC students ([Nitish](https://github.com/nitish1295) and [Ankita](https://github.com/AnkitaKumariJain14)) from our lab at IIT Gandhinagar for generating all figures in this section.

<p align="center">
<img width="545" alt="image" src="https://user-images.githubusercontent.com/59758528/189543023-e9c83265-4781-4a0e-95b2-a9019ab8c520.png">
</p>

## [JAX](https://github.com/google/jax): an ML library in sync with pure Python

During GSoC, I got introduced to JAX for the first time. After some exploration, I found JAX as a quick and computationally fast prototyping library. Tools like `vmap`, `jit`, `tree_util` and `flatten_util` were elementry in the code I wrote during GSoC. I summarized the JAX tricks we learned during the GSoC period [here](https://github.com/probml/pyprobml/blob/master/notebooks/tutorials/practical_jax_tips.ipynb).

## Summary of PRs
Following table containts the list of PRs created during the GSoC period sorted by time.

| URL                                                     | Title                                                           |
|:--------------------------------------------------------|:----------------------------------------------------------------|
| [PR 690](https://github.com/probml/pyprobml/pull/690)   | Update beta_binom_post_plot.py                                  |
| [PR 703](https://github.com/probml/pyprobml/pull/703)   | Add workflow and jupyter-book setup                             |
| [PR 704](https://github.com/probml/pyprobml/pull/704)   | Added discrete_prob_dist_plot.ipynb                             |
| [PR 707](https://github.com/probml/pyprobml/pull/707)   | Do not auto generate scripts                                    |
| [PR 709](https://github.com/probml/pyprobml/pull/709)   | Rename environment variables                                    |
| [PR 719](https://github.com/probml/pyprobml/pull/719)   | Remove jupyter book                                             |
| [PR 721](https://github.com/probml/pyprobml/pull/721)   | add `combining_kernels_by_multiplication` notebook              |
| [PR 722](https://github.com/probml/pyprobml/pull/722)   | add `combining_kernels_by_summation` notebook                   |
| [PR 727](https://github.com/probml/pyprobml/pull/727)   | Fig18.2 (Book2) add `gprDemoArd.ipynb`                          |
| [PR 728](https://github.com/probml/pyprobml/pull/728)   | Fig18.7 (Book2) add `gprDemoNoiseFreeAndNoisy.ipynb`            |
| [PR 741](https://github.com/probml/pyprobml/pull/741)   | converted py files to notebooks.                                |
| [PR 750](https://github.com/probml/pyprobml/pull/750)   | Update gprDemoNoiseFreeAndNoisy                                 |
| [PR 763](https://github.com/probml/pyprobml/pull/763)   | Mention Python version in `README`                              |
| [PR 764](https://github.com/probml/pyprobml/pull/764)   | Split the workflow. Enable static module checker.               |
| [PR 779](https://github.com/probml/pyprobml/pull/779)   | pin Python 3.7.13 in workflow                                   |
| [PR 780](https://github.com/probml/pyprobml/pull/780)   | Copied d2l notebooks to pyprobml                                |
| [PR 787](https://github.com/probml/pyprobml/pull/787)   | Move non-figure notebooks to pyprobml                           |
| [PR 795](https://github.com/probml/pyprobml/pull/795)   | Combine and publish results from parallel workflows             |
| [PR 798](https://github.com/probml/pyprobml/pull/798)   | Updated README.md and CONTRIBUTING.md                           |
| [PR 800](https://github.com/probml/pyprobml/pull/800)   | Copy `probml-notebooks/notebooks` to `notebooks/misc`           |
| [PR 805](https://github.com/probml/pyprobml/pull/805)   | Push updated notebooks to misc                                  |
| [PR 824](https://github.com/probml/pyprobml/pull/824)   | Add book2 notebooks                                             |
| [PR 834](https://github.com/probml/pyprobml/pull/834)   | GitHub to colab                                                 |
| [PR 846](https://github.com/probml/pyprobml/pull/846)   | Add autogenerated contributors' list                            |
| [PR 871](https://github.com/probml/pyprobml/pull/871)   | Refactor deep kernel learning figure                            |
| [PR 874](https://github.com/probml/pyprobml/pull/874)   | Fix workflow and latexify spectral mixture gp figures           |
| [PR 919](https://github.com/probml/pyprobml/pull/919)   | Latexified and blackjaxified figure 17.18 `gp_kernel_opt.ipynb` |
| [PR 1046](https://github.com/probml/pyprobml/pull/1046) | AL notebooks added                                              |
| [PR 1081](https://github.com/probml/pyprobml/pull/1081) | added gaussian 2d ADVI                                          |
| [PR 1084](https://github.com/probml/pyprobml/pull/1084) | Added GMM ADVI notebook                                         |
| [PR 1099](https://github.com/probml/pyprobml/pull/1099) | Latexify vib_demo                                               |

## Summary

This GSoC I worked on a big project useful to the academic community around the world and with a wonderful mentor Dr. Kevin Murphy. Simultaniously, I learned my new default ML library JAX and increased my confidence to be able to work on such large projects. I will always be grateful to Dr. Kevin Murphy for this opportunity that helped me add a unique and valuable experience in my PhD journy.
